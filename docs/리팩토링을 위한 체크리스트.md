# 리팩토링을 위한 체크리스트
> 목적: 사용하지 않는 함수·변수를 제거하고, 폴더 구조를 기능 단위로 재구성해 코드 탐색성을 높인다. (기준 날짜: 2026-02-02, 현재 `main` 상태)

## 지금 리팩토링해도 되는 근거
- TypeScript `strict` + `noUnusedLocals/noUnusedParameters`가 이미 활성화되어 미사용 코드가 빌드 타임에 검출된다.
- 2026-02-02 기준 `npm run lint -- --max-warnings=0` 통과 상태라, 리팩토링 후에도 동일 기준으로 회귀 여부를 바로 확인할 수 있다.
- Vite 개발 서버와 Mock API(`VITE_USE_MOCK_API=true`)가 준비되어 있어 백엔드 없이도 주요 플로우를 재현·검증 가능하다.
- 기능별 파일이 어느 정도 분리돼 있음(`pages/{schedule,tasks,today,statistics,auth}`, `components/{schedules,tasks,modals,layout}`), 이동/모듈화 범위가 명확하다.
- 빌드 산출물은 `dist/`로 분리되어 있으며 서비스워커는 프로덕션에서만 등록되므로 개발 중 구조 변경이 런타임에 직접적인 영향을 주지 않는다.

## 현재 구조 짧은 메모
- 진입점: `src/main.tsx`(Mock 서버 토글), `src/app/App.tsx`(라우팅·Provider 체인).
- 컨텍스트: `src/shared/contexts/{ScheduleCache,TaskCache,ScheduleViewState,TimePreferences,Toast}Context`.
- 훅: 일정(`src/features/schedules/hooks`), 통계(`src/features/statistics/hooks`), 푸시(`src/shared/hooks/usePushSubscription`).
- 페이지/컴포넌트: 기능별로 `src/features/{today,schedules,tasks,statistics,auth,landing,settings}/{pages,components,hooks,api,types}`로 정리.
- API: 공통 설정·클라이언트는 `src/shared/api`, 도메인 API는 각 feature `api/`에 배치.
- 유틸: 공통 유틸은 `src/shared/utils`(datetime/events/priorityStyles 등), 타입은 `src/shared/types` + 도메인 타입은 각 feature `types/`.

## 체크리스트

### 0. 준비/가이드
- [x] 새 브랜치에서 진행하고 리팩터링 단위를 작게 나눠 커밋.
- [x] `.env.local`에 `VITE_API_BASE_URL`, `VITE_USE_MOCK_API=true` 설정 후 `npm run dev`로 수동 검증 환경 확보.
- [x] 기준 커맨드 확인: `npm run lint`, `npm run build`(tsc -b 포함). 실패 시 우선 수정 후 다음 단계로 이동.

### 1. 미사용 코드/변수 제거
- [x] `npm run build`로 `noUnusedLocals/Parameters`가 잡는 미사용 export·변수·props를 제거(2026-02-02 수행, 통과).
- [x] 빈 디렉터리/파일 정리: `src/hooks/schedulestate/`, `src/styles/`, `scripts/` → 삭제하거나 실제 구현을 채운다.
- [x] `useScheduleViewState`의 Provider 내부 상태와 fallback 상태 이중 유지 여부 결정 → App 전역 Provider를 전제로 fallback 분기 제거해 불필요한 상태를 없앤다.
- [x] 과도한 콘솔 로그(`api/httpClient.ts`, `utils/statisticsTransform.ts` 등)를 개발 플래그로 감싸거나 제거해 노이즈 감소.
- [x] Mock 서버(`src/mocks`)에서 사용되지 않는 핸들러/데이터 export가 있는지 확인 후 제거.

### 2. 폴더 구조 재구축(기능 중심)
- [x] 목표 구조 예시  
  - `src/features/schedules/{pages,components,hooks,api,types}` (ScheduleForm, ScheduleCard, SchedulesTabPage 등)  
  - `src/features/tasks/{pages,components,hooks,api,types}` (TaskList/Detail/Form, 모달 포함)  
  - `src/features/statistics/...`, `src/features/auth/...`, `src/features/today/...`  
  - `src/shared/{components,contexts,hooks,api,utils,styles}` (`StatusPanel`, `ToastProvider`, `TimePreferences`, `datetime` 등 공통 배치)  
  - `src/app` 또는 `src/routes`에 라우터·AppShell 배치
- [x] Vite 경로 alias 추가(`vite.config.ts` + `tsconfig.app.json` `paths`)로 `../../../` 경로를 축소.
- [x] 각 feature에 barrel(`index.ts`)을 두어 외부 노출을 제한하고 import 경로를 단순화.

### 3. API/데이터 층 리팩터링
- [x] `api/httpClient.ts`의 토큰 갱신·로그 로직을 유틸로 분리해 재사용/테스트 용이하게 정리.
- [x] API 모듈을 feature 폴더로 이동하고 요청/응답 타입을 도메인별 `types/`로 구분.
- [ ] 시간대 쿼리(`utils/timeParams.ts`)와 `toApiDateTimeWithZone` 사용법을 문서화하고 중복 계산을 제거.

### 4. 상태/컨텍스트 정리
- [x] Schedule/Task 캐시 컨텍스트를 `src/shared/contexts`로 이동 완료(이벤트 헬퍼 타입 안전화는 추후 진행 필요).
- [ ] ScheduleViewState와 TimePreferences 의존 관계를 문서화하고 hook vs context 중 하나로 일원화.
- [ ] MiniPlayerBar, TodayPage, SchedulesTabPage에서 공유되는 일정-작업 동기화 로직을 공통 훅(`useScheduleTaskSync`)으로만 사용하도록 정리.
- [x] 이벤트 유틸에 타입 세이프 헬퍼 추가(`dispatchTaskChanged/dispatchScheduleChanged/on*`); 소비처를 공통 헬퍼로 전환.

### 5. UI/스타일 정리
- [x] 전역 CSS(`App.css`, `index.css`)와 도메인 CSS(`pages/*/*.css`, `components/*/*.css`)를 feature 폴더로 옮기거나 CSS Modules로 전환해 범위를 명확히 한다.
- [x] 공통 UI(`StatusPanel`, `BottomTabBar`, `TopBar`, `Toast`)를 `shared/components`로 이동하고 props 타입을 명시.
- [ ] 포인터/터치 드래그 로직이 긴 `SchedulesTabPage`를 표현 컴포넌트와 로직 훅으로 분리해 가독성을 개선.

### 6. 날짜·시간·알림
- [ ] 모든 날짜 계산이 `TimePreferencesContext`와 `utils/datetime`을 경유하는지 확인하고, `toISOString` 직접 호출이 있으면 `toApiDateTimeWithZone` 등으로 교체.
- [x] FCM 설정(`src/firebase/config.ts`, `messaging.ts`)을 `.env` 기반으로 치환하고, 프로덕션 빌드에서만 초기화되도록 가드 추가.
- [ ] 서비스워커 등록(main.tsx)과 푸시 토큰 발급 흐름을 문서화하고, mock 모드에서 비활성화되는지 확인.

### 7. 테스트/검증 플로우
- [x] lint/build 통과 확인 (`npm run lint`, `npm run build`).
- [ ] 수동 시나리오: 로그인/가드 → Today 탭 데이터/배정 → 일정 CRUD+상태전환(드래그 이동 포함) → Task CRUD/완료 토글/아카이브 → Task→Schedule 복사 → 통계 주간 이동 → 설정(시간대) → FCM 토큰 발급 로깅.
- [ ] Mock API와 실서버(`VITE_API_BASE_URL` 제거 시) 각각에서 핵심 플로우 연속 수행 후 회귀 이슈를 기록.
